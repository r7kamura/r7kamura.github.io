<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>DocomoruでBOTと雑に会話する</title>
  <link href="https://r7kamura.com/articles/2014-12-06-q" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  
  <meta property="description" content="docomoが提供している雑談対話APIを利用し、docomoruというライブラリを使いながらBOTと雑談する方法について説明します。">
  <meta property="og:description" content="docomoが提供している雑談対話APIを利用し、docomoruというライブラリを使いながらBOTと雑談する方法について説明します。">
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="DocomoruでBOTと雑に会話する">
  <meta property="og:url" content="https://r7kamura.com/articles/2014-12-06-q">
  
  <meta property="og:image" content="https://qiita-image-store.s3.amazonaws.com/0/4365/2702e398-89d9-cf36-60da-e8e6cf71296b.png">
  <meta property="twitter:card" content="summary_large_image">
  
</head>
<body>
  <header>
    <nav>
      <a href="/">r7kamura.com</a>
      <ul>
        <li>
          <a href="/links">リンク集</a>
        </li>
        <li>
          <a href="https://www.google.com/search?q=site:r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <header>
    <time datetime="2014-12-06T00:00:00+00:00">2014年12月06日</time>
    <h1>DocomoruでBOTと雑に会話する</h1>
  </header>
  <div>
    <p>docomoが提供している<a href="https://dev.smt.docomo.ne.jp/?p=docs.api.page&amp;api_docs_id=5">雑談対話API</a>を利用し、<a href="https://github.com/r7kamura/docomoru">docomoru</a>というライブラリを使いながらBOTと雑談する方法について説明します。後半では、<a href="https://github.com/r7kamura/ruboty">Ruboty</a>を使ってチャットサービス上でBOTと雑談する方法について説明します。</p>

<h2>docomoru</h2>

<p><a href="https://github.com/r7kamura/docomoru">docomoru</a>は、docomoのAPIを利用することを目的として作られたRuby製のライブラリです。<code>gem install docomoru</code> でインストールできます。docomoのAPIキーが必要なので、予め <a href="https://dev.smt.docomo.ne.jp/">https://dev.smt.docomo.ne.jp/</a> からアプリ登録申請を済ませてAPIキーを発行してもらいましょう。</p>

<h3>使い方</h3>

<p>docomoruはCLI経由で利用でき、APIキーと文字列を与えると雑談対話APIにリクエストを送り、レスポンスをJSON形式で標準出力します。APIキーは、--api-keyオプションか、環境変数DOCOMO_API_KEY経由で与えます。雑談対話APIを利用するには、<code>docomoru create_dialogue &lt;文字列&gt;</code> のようにコマンドを実行します。</p>

<h3>例</h3>

<p>以下は予め環境変数DOCOMO_API_KEYを設定してdocomoruを利用してみた例です。docomoruは結果をJSONで出力しますが、例えば <a href="http://stedolan.github.io/jq/">jq</a> を使えば簡単にJSONの中から値を取り出せます。かわいいですね。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/4365/2702e398-89d9-cf36-60da-e8e6cf71296b.png" target="_blank"><img src="https://qiita-image-store.s3.amazonaws.com/0/4365/2702e398-89d9-cf36-60da-e8e6cf71296b.png" alt="image"></a></p>

<h3>応用</h3>

<p>雑に関数を定義すれば更に雑談しやすくなります。ねむいですね。</p>

<pre><code class="sh">$ @yunotti() { docomoru create_dialogue $1 | jq .utt -M -r }
$ @yunotti 寒い
ねむい
$ @yunotti ねむいの
寝ろー
</code></pre>

<h2>チャットで使う</h2>

<p>SlackやHipChatなどチャットのBOTにこれを組み込む場合には、<a href="https://github.com/r7kamura/ruboty">Ruboty</a>のプラグインとして<a href="https://github.com/r7kamura/ruboty-talk">ruboty-talk</a>が提供されています。これを入れると、既に登録されている他のどのルールにも一致しなかったとき、docomoruを利用して雑に発言を返してくれるようになります。</p>

<p>Rubotyで利用するには、Gemfileにruboty-talkを追加して、環境変数にDOCOMO_API_KEYを与えれば動作します。Rubotyを新しく導入する場合には、<a href="http://qiita.com/r7kamura/items/8d1b98e28154de6030b9">Ruby製HubotクローンのRubotyをSlackで動かす - Qiita</a> などを参考にしてください。</p>

<h2>tqbot</h2>

<p>家庭や職場での貴重な雑談の様子を紹介します。これはシェアハウスに住んでいるtqbot。初期の頃は不具合でRedisがすぐに揮発し、よく記憶が無くなっていました。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/4365/e6d87b0f-9cc5-9460-cd18-61c6675b0dc3.png" target="_blank"><img src="https://qiita-image-store.s3.amazonaws.com/0/4365/e6d87b0f-9cc5-9460-cd18-61c6675b0dc3.png" width="300"></a></p>

<h3>qiitan</h3>

<p>これは職場で飼っているQiitan。デプロイは全て彼にお願いしています。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/4365/e4869074-4246-2908-2836-f39947e833ec.png" target="_blank"><img src="https://qiita-image-store.s3.amazonaws.com/0/4365/e4869074-4246-2908-2836-f39947e833ec.png" width="360"></a></p>

<h2>おわり</h2>

<p>最近リモートワークなども流行っていますが、お互いの顔がすぐに見えない状況下では距離感が掴みづらくなりがちですし、雑談ルームなどで緩い雰囲気をつくることでコミュニケーションの量を保っていけると良いですね。</p>

  </div>
</article>

  </main>
</body>
</html>
