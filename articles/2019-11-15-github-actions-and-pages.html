<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>GitHub Actions × GitHub Pages</title>
  <link href="https://r7kamura.com/articles/2019-11-15-github-actions-and-pages" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  
  <meta property="description" content="このウェブサイトの生成には、GitHub ActionsとGitHub Pagesを使っている。">
  <meta property="og:description" content="このウェブサイトの生成には、GitHub ActionsとGitHub Pagesを使っている。">
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="GitHub Actions × GitHub Pages">
  <meta property="og:url" content="https://r7kamura.com/articles/2019-11-15-github-actions-and-pages">
  
  <meta property="og:image" content="https://r7kamura.com/default_og_image.jpg">
  <meta property="twitter:card" content="summary">
  
</head>
<body>
  <header>
    <nav>
      <a href="/">r7kamura.com</a>
      <ul>
        <li>
          <a href="/articles">一覧</a>
        </li>
        <li>
          <a href="https://www.google.com/?as_sitesearch=r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <header>
    <time datetime="2019-11-15T00:00:00+00:00">2019年11月15日</time>
    <h1>GitHub Actions × GitHub Pages</h1>
  </header>
  <div>
    <p>このウェブサイトの生成には、GitHub ActionsとGitHub Pagesを<a href="https://github.com/r7kamura/r7kamura.com/blob/113cef36c0c635f35f1c155061381776cfb71ff2/.github/workflows/publish.yml">使っている</a>。developブランチが更新されたら、<code>npm run build</code> を実行して、<code>peaceiris/actions-gh-pages@v2.5.0</code> でGitHub Pages用のブランチに成果物をpushする──という簡単な仕組みなはずなんだけど、作業中に幾つかはまりどころがあったので書き残しておく。</p>

<h2>GITHUB_TOKENの権限は弱い</h2>

<p>デフォルトで用意されているGITHUB_TOKENを利用して静的ファイルをpushすれば、GitHub Pagesに反映される……かと思いきや、そうはならない。リポジトリの設定画面からGitHub Pagesのビルドで何らかのエラーが発生したことは確認できるのだけど、それ以上のことは分からない。</p>

<p>Publicリポジトリ向けに用意されているアクセストークンには、GitHub Pages向けのイベントを発火する<a href="https://github.community/t5/GitHub-Actions/Github-action-not-triggering-gh-pages-upon-push/m-p/26869/highlight/true#M301">権限が足りないらしい</a>。解決策の一つとして、適切な権限を持ったPersonal Access Tokenを発行して代わりに使う方法があるので、今回はそうすることにした。</p>

<p>丁度最近、GitHub Packagesの正式リリースと共にGITHUB_TOKENにread:packagesの権限が追加されていた。GitHub ActionsからGitHub Pagesを利用したいケースはよくあるだろうと思うので、今後これについても権限が追加されるかもしれないと思っている。</p>

<h2>文字列リテラルは一重引用符</h2>

<p>これはGitHub Pagesは関係無い話題。キャッシュ機能を使うために <code>hashFiles("package-lock.json")</code> と書いていたのだけど、ここで怒られた。GitHub Actionsでの文字列リテラルは、二重引用符ではなく一重引用符で囲む必要がある。ドキュメントにも<a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/contexts-and-expression-syntax-for-github-actions#literals">そう書いてある</a>。</p>

  </div>
</article>

  </main>
</body>
</html>
