<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>Terminalで新しいタブを現在のディレクトリで開く</title>
  <link href="https://r7kamura.com/articles/2011-02-21-h" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  
  <meta property="description" content="TerminalではCommand+Tで新しいタブを開くことが出来ますが、新規タブはホームディレクトリで開かれてしまい、Screenのように現在のディレクトリで開いてくれません。">
  <meta property="og:description" content="TerminalではCommand+Tで新しいタブを開くことが出来ますが、新規タブはホームディレクトリで開かれてしまい、Screenのように現在のディレクトリで開いてくれません。">
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="Terminalで新しいタブを現在のディレクトリで開く">
  <meta property="og:url" content="https://r7kamura.com/articles/2011-02-21-h">
  
  <meta property="og:image" content="https://r7kamura.com/default_og_image.jpg">
  <meta property="twitter:card" content="summary">
  
</head>
<body>
  <header>
    <nav>
      <a href="/">r7kamura.com</a>
      <ul>
        <li>
          <a href="/articles">一覧</a>
        </li>
        <li>
          <a href="https://www.google.com/?as_sitesearch=r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <header>
    <time datetime="2011-02-21T00:00:00+09:00">2011年02月21日</time>
    <h1>Terminalで新しいタブを現在のディレクトリで開く</h1>
  </header>
  <div>
    <p>TerminalではCommand+Tで新しいタブを開くことが出来ますが、新規タブはホームディレクトリで開かれてしまい、Screenのように現在のディレクトリで開いてくれません。ほとんどの場合はカレントディレクトリで開いてくれる方が便利なので、それを実現する方法を模索しました。</p>

<p>結果から先に言うと「"pwd"で出力するフルパスを覚えておいてCommand+Tと押した後に"cd"コマンドでそれを入力する」というAppleScriptを書いてTerminalからコマンドで呼び出すようにしました。この方法に決定した理由は以下の通りです。</p>

<ol>
<li>TerminalなのでAppleScriptが動く環境</li>
<li>AppleScriptの動作は速い</li>
<li>AppleScriptは書いたことないけど便利そうなので勉強しとくと今後貢献してくれそう</li>
<li>スクリプトをコマンドで呼び出すだけ、というのが理解しやすくて安心</li>
</ol>

<h4>AppleScriptの記述と配置</h4>

<p>TerminalでAppleScriptを呼び出すには、osascript(/usr/bin/osascript)コマンドを利用します。<br>
なお、2011/02/21現在のSnowLeopard(10.6)ではosascript実行時にAdobe関係のライブラリが警告を出力する場合があるため、実行時にAdobeっぽい警告が出るなーやだなーという人はAdobeからパッチをダウンロードしてください。</p>

<p>下記のようなスクリプトを書いて実行権限を与えます。"chmod +x hoge.applescript"とかですね。AppleScriptは初経験でしたが雰囲気Rubyっぽい構文ですね。</p>

<pre><code>#!/usr/bin/osascript # createTabAtCurrentDirectory.applescript # input "Command + T" then cd to current directory in Mac OSX Terminal.appon run argv set cmd to "cd" &amp; " " &amp; do shell script "pwd"tell application "Terminal"activatetell application "System Events"tell process "Terminal" to keystroke "t" using command down end telldo script with command cmd in selected tab of the front window # erase scroll buffer (Command + K in Terminal.app) tell application "System Events"tell process "Terminal" to keystroke "k" using command down end tellreturnend tellend run
</code></pre>

<p>あとはコマンドから"osascript hoge.applescript"とか呼び出すだけですね。ちなみに自分の場合は~/Dropbox/Script/というディレクトリに便利系スクリプトを置いて管理しているので、~/.bashrcに以下のようにaliasを記述してコマンド"t"で呼び出せるようにしています。</p>

<pre><code>alias t='~/Dropbox/Script/createTabAtCurrentDirectory.applescript'
</code></pre>

<h4>その他</h4>

<p>前回KeyRemap4MacBookという奴を使ったのでそれを利用して「TerminalでCommand+Kを入力すると"pwd | pbcopy"→Command+T→"pbpaste | cd"を入力」みたいなキー設定にしようかななんて考えていたのですが、シェルスクリプトとかである程度省略しても気持ち悪すぎるかなと思って途中で止めました。ちなみにその時に書いて.bashrcの一部があって別の用途で使えるかもしれないので載せておきます。</p>

<pre><code>alias g='growl -H localhost -m' # "g"に文字列を渡すとGrowlで通知します。ruby-growlが必要ですalias pp='pwd | pbcopy ; pbpaste | g' # "pp"でカレントディレクトリ名をコピーしてgrowlでも通知しますalias cdp='cd `pbpaste`' # "cdp"でコピーしたディレクトリへ移動できます。新しいタブを開いた後などにどうぞ # Finderでフォルダを選択してコピーした後とかにもどうぞどうぞ
</code></pre>

  </div>
</article>

  </main>
</body>
</html>
