<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>DiscordのWebhookとチャンネル設計</title>
  <link href="https://r7kamura.com/articles/2020-10-26-discord-webhooks-and-channels" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  
  <meta property="description" content="TwitterやGitHubからDiscordに自動で投稿させる方法と、この手の自動投稿を扱う際のより良いチャンネル設計について。">
  <meta property="og:description" content="TwitterやGitHubからDiscordに自動で投稿させる方法と、この手の自動投稿を扱う際のより良いチャンネル設計について。">
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="DiscordのWebhookとチャンネル設計">
  <meta property="og:url" content="https://r7kamura.com/articles/2020-10-26-discord-webhooks-and-channels">
  
  <meta property="og:image" content="https://r7kamura.com/default_og_image.jpg">
  <meta property="twitter:card" content="summary">
  
</head>
<body>
  <header>
    <nav>
      <a href="/">r7kamura.com</a>
      <ul>
        <li>
          <a href="/articles">一覧</a>
        </li>
        <li>
          <a href="https://www.google.com/?as_sitesearch=r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <header>
    <time datetime="2020-10-26T00:00:00+09:00">2020年10月26日</time>
    <h1>DiscordのWebhookとチャンネル設計</h1>
  </header>
  <div>
    <p>TwitterやGitHubからDiscordに自動で投稿させる方法と、この手の自動投稿を扱う際のより良いチャンネル設計について。</p>

<h2>背景</h2>

<p>DiscordのYATTEIKIサーバー (<a href="https://yatteiki.fm/">yatteiki.fm</a>の収録や管理に使っているサーバー) のWebhookの設定とチャンネルの設計を見直す機会があったので、ついでに設定方法をまとめておこうと思い、この記事を書くことにした。</p>

<h2>GitHub</h2>

<p>DiscordでWebhookの受信用URLを発行し、GitHubのリポジトリでWebhookの送信用設定を行うと、そのリポジトリでの様々な変更をDiscordに通知できる。</p>

<p>DiscordはGitHubのWebhookへのサポートが手厚く、簡単に設定できるように特別な口を設けているので、設定も簡単だ。具体的には、Discordで発行したWebhookのURLの末尾に <code>/github</code> を足したものをGitHubに設定するだけで良い。どんなイベントを通知するかも、GitHub側で簡単に設定できる。</p>

<p>具体的な設定方法は、<a href="https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks">DiscordのWebhookのドキュメント</a>を見るのが良い。</p>

<h2>Twitter</h2>

<p>DiscordでWebhookの受信用URLを発行し、<a href="https://ifttt.com/">IFTTT</a>でTwitter検索用のアプレット（IFTTTにおける自動化の設定の単位）を設定すると、Twitterでの定期的な検索結果をDiscordに通知できる。</p>

<p>TwitterはWebhookを送信する機能を設けていないので、IFTTTが必要になる。IFTTTは無料アカウントだと3つまでアプレットを設定できる。IFTTTからTwitterの機能を利用する場合は、検索だけの利用でも連携するためのTwitterアカウントが必要になるので注意。</p>

<p>IFTTT側で以下のようにレスポンスボディを設定すると、検索条件に一致したツイートのURLが通知されるようになる。Discordが自動的にURLの内容を展開してくれるので、ツイートの中身はそこから読める。</p>

<pre><code>{
  "content": "{{LinkToTweet}}"
}
</code></pre>

<hr>

<p>DiscordやSlackなどでこういう自動投稿的なものを管理する上で、自分が気を付けたいと思っていることについて触れておく。</p>

<h2>自動投稿専用チャンネル</h2>

<p>人間の投稿するチャンネルにBotによる自動的な投稿が混ざると、盛り上がっているうちは良いが、そのうち居心地が悪くなったり、廃墟化したりしやすくなる。通知・未読・購読・権限・アーカイブなどはチャンネル単位で設定できるように設計されているので、この手の自動的な投稿にはそれぞれ専用のチャンネルを用意することを基本的にはおすすめしたい。</p>

<h2>チャンネルとカテゴリの設計</h2>

<p>更に踏み込んだ話をすると、カテゴリについても配慮しておいた方が良い。Discordではカテゴリごとミュートする機能がある。これは例えば「自動投稿の通知は受け取りたくないが未読管理はしたい」といったケースなどで活用できる。こういう事情があるので、できれば自動投稿系のチャンネルや死んだチャンネルをそれぞれカテゴリにまとめるなどしておくと、取り回しやすくなる。</p>

<p>例えばYATTEIKIサーバーでは、簡略化するとこういう感じでチャンネルが配置されている。</p>

<ul>
<li>VOICE

<ul>
<li>🔊スタジオ</li>
</ul>
</li>
<li>TEXT

<ul>
<li>#general</li>
</ul>
</li>
<li>BOT

<ul>
<li>#analytics</li>
<li>#github</li>
<li>#twitter</li>
</ul>
</li>
<li>ARCHIVE

<ul>
<li>...</li>
</ul>
</li>
</ul>

<p>カテゴリの設計や未読の管理はキーボードや携帯端末での操作性にも関わってくる。この辺りに普段から気を配っておくと、より快適な人生を過ごせるようになるはず。</p>

  </div>
</article>

  </main>
</body>
</html>
