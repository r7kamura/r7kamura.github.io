<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>atom-shell情報</title>
  <link href="/articles/2014-08-31-q" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  <meta property="og:type" content="article">
  <meta property="og:title" content="atom-shell情報">
  <meta property="og:url" content="https://r7kamura.com/articles/2014-08-31-q">
  <meta property="twitter:card" content="summary">
</head>
<body>
  <header>
    <nav>
      <a href="/">トップページ</a>
      <ul>
        <li>
          <a href="/articles">記事</a>
        </li>
        <li>
          <a href="https://google.com/search?q=site:r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <h1>atom-shell情報</h1>
  <footer>
    <p>
      <time datetime="2014-08-31T00:00:00+09:00">2014年08月31日</time>
    </p>
  </footer>
  <div>
    <p>atom-shellとはどういうもので、どのようにすれば動かせるのかということを調べているので、その過程で得られた情報をまとめておく。</p>
<h3 id="atom-shellでデスクトップアプリをつくれる">atom-shellでデスクトップアプリをつくれる</h3>
<p>GitHub製のAtomというエディタはatom-shellというライブラリを利用して実現されている。atom-shellはJavaScriptでデスクトップアプリケーションをつくるための便利なライブラリで、ネイティブAPIを実行するための実行環境を提供することでそれを実現させようとしている。Webサーバの代わりにデスクトップアプリケーションに特化したNode.jsの実行環境だと考えても良いだろう。</p>
<h3 id="atom-shellには2つの側面がある">atom-shellには2つの側面がある</h3>
<p>Node.jsでWebアプリを書いたことがあれば分かるかもしれないが、JavaScriptのコードにはサーバサイドで動かすためのものとクライアントサイドで動かすためのものの二種類が存在する。サーバサイドのものはNode.jsの実行環境で動作し、クライアントサイドのものはユーザのブラウザ上で動作する。</p>
<h3 id="クライアントとブラウザという風に呼び分ける">クライアントとブラウザという風に呼び分ける</h3>
<p>atom-shellでも、画面上でWebページを描画しつつatom-shellの実行環境でコードを動かす必要があるので、このサーバサイド-クライアントサイドの関係と似たような概念を持っている。Node.jsに合わせて、atom-shellではWebページの描画環境で動作するコードをクライアントスクリプト、atom-shellの実行環境で動作するコードをブラウザスクリプトと呼ぶことにする。Webブラウザのことではなく、Node.jsでサーバサイドを担当していたもののことを「ブラウザ」と呼ぶことにしているので注意。</p>
<h3 id="クライアント-ブラウザ間はrpcで通信する">クライアント-ブラウザ間はRPCで通信する</h3>
<p>Node.js製のアプリではWebSocketを利用してクライアントとサーバ間の通信を行ったりするが、atom-shellではipcと呼ばれるモジュールを利用してクライアントとブラウザ間の通信を行う。また、RPCを簡単に行うためのremoteと呼ばれるモジュールも提供している。普通のWebページはWebブラウザの外側と通信するように出来ていないが、これではネイティブのシステム部分と協調させるのには不便なので、atom-shellではNode-WebkitのようにWebページの中からNode.jsのAPIを触れるようになっている。</p>
<h3 id="atom-shellでサンプルアプリを動かす">atom-shellでサンプルアプリを動かす</h3>
<p>適当なJavaScriptのファイルと、そのファイルの名前を記述したpackage.json、それからアプリを動かすOS用のatom-shellのバイナリファイルを用意すれば、アプリを動かせる。</p>
<pre><code class="language-js">// package.json
{
  &quot;main&quot;: &quot;main.js&quot;
}</code></pre>
<pre><code class="language-js">// main.js
var app           = require(&#39;app&#39;);
var BrowserWindow = require(&#39;browser-window&#39;);
var mainWindow    = null;

app.on(&#39;ready&#39;, function () {
  mainWindow = new BrowserWindow({
    width: 800,
    height: 600
  });
  mainWindow.loadUrl(&#39;https://github.com/&#39;);
});</code></pre>
<p>以上のファイルを用意して、<a href="https://github.com/atom/atom-shell/blob/master/docs/tutorial/application-distribution.md">ここ</a>からatom-shellのバイナリファイルを用意して、コマンドラインから引数でディレクトリを指定しながら起動すればアプリが起動する。800x600の大きさのウィンドウが開いてGitHubを描画するだけというアプリになる。下記のコードではAtom.appとなっているが、これはエディタのAtom.appと同名ではあるものの全く別のアプリなので注意されたい。</p>
<pre><code class="language-sh">~/Downloads/atom-shell-v0.15.9-darwin-x64/Atom.app/Contents/MacOS/Atom .</code></pre>
<h3 id="node-webkitとそこまで変わらない">node-webkitとそこまで変わらない</h3>
<p>atom-shellは、Atomエディタをつくるためにnode-webkitを改良してつくられている。atom-shellはプログラムのエントリポイント(アプリ開発者から見て最初に実行されるところ)としてJavaScriptを指定するようになっているが、node-webkitはアプリのエントリポイントとしてHTMLファイルを指定する。また、提供するウィンドウのサイズやアプリ全体の挙動なども、atom-shellではJavaScriptで制御するようになっているのに対して、node-webkitではpackage.jsonで指定するようになっている (その設計が原因かnode-webkitよりatom-shellの方が複数のウィンドウを持つアプリを実装するのが容易である)。以下はnode-webkitで至極単純なアプリを動かすときのコード例。</p>
<pre><code class="language-js">// package.json
{
  &quot;main&quot;: &quot;main.html&quot;
}</code></pre>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;main.html&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    foo
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>以上のファイルを用意して、<a href="https://github.com/rogerwang/node-webkit">ここ</a>からnode-webkitのバイナリファイルを用意し、(atom-shellのときと同様に)コマンドラインから引数でディレクトリを指定しながら起動すればアプリが起動するという仕組みになっている。</p>
<pre><code class="language-sh">/Users/r7kamura/Downloads/node-webkit-v0.10.2-osx-x64/node-webkit.app/Contents/MacOS/node-webkit .</code></pre>
<h3 id="この辺を読むと参考になる">この辺を読むと参考になる</h3>
<p>atom/atom-shellのレポジトリに幾つかのドキュメントが含まれているので、まず一通りその資料に目を通すのが良い。Atomエディタはatom-shellを利用して実装されているので、atom/atomをサンプルコードとして見ることもできる。また、atom-shellの開発者の1人がSpeaker Deckに資料を上げており、Node.jsとatom-shellとの関係性ついての説明が含まれている。</p>
<p>もし更に踏み込みたい場合は、atom-shellがどのように実現されているのかということを知る必要があるだろうから、atom-shellをビルドするために利用されているgypやninja、それから内部で利用されているchromiumについて調べるのも良いかもしれない。</p>
<p>また、atom-shellよりもnode-webkitの方が現状より多く利用されており、サンプルやドキュメントなどもnode-webkitのものを見るほうが現状では情報量が多い。rogerwang/node-webkitにプレゼン資料やブログ記事などへのリンクが掲載されているので、これを見るとnode-webkitのことがより理解できるかもしれない。</p>
<ul>
<li><a href="https://github.com/atom/atom">atom/atom</a></li>
<li><a href="https://github.com/atom/atom-shell">atom/atom-shell</a></li>
<li><a href="https://speakerdeck.com/zcbenz/practice-on-embedding-node-dot-js-into-atom-editor">Practice on embedding Node.js into Atom Editor // Speaker Deck</a></li>
<li><a href="https://code.google.com/p/gyp/">gyp - Generate Your Projects - Google Project Hosting</a></li>
<li><a href="https://code.google.com/p/chromium/wiki/NinjaBuild">NinjaBuild - chromium - Using the Ninja build system</a></li>
<li><a href="https://github.com/rogerwang/node-webkit">rogerwang/node-webkit</a></li>
</ul>

  </div>
</article>

  </main>
</body>
</html>
