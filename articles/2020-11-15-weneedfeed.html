<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>Weneedfeed</title>
  <link href="https://r7kamura.com/articles/2020-11-15-weneedfeed" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  
  <meta property="description" content="ウェブページからフィードを生成するweneedfeedというツールをつくった。">
  <meta property="og:description" content="ウェブページからフィードを生成するweneedfeedというツールをつくった。">
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="Weneedfeed">
  <meta property="og:url" content="https://r7kamura.com/articles/2020-11-15-weneedfeed">
  
  <meta property="og:image" content="https://r7kamura.com/default_og_image.jpg">
  <meta property="twitter:card" content="summary">
  
</head>
<body>
  <header>
    <nav>
      <p>
        <a href="/">r7kamura.com</a>
      </p>
      <ul>
        <li>
          <a href="/links">リンク集</a>
        </li>
        <li>
          <a href="https://www.google.com/search?q=site:r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <header>
    <time datetime="2020-11-15T00:00:00+00:00">2020年11月15日</time>
    <h1>Weneedfeed</h1>
  </header>
  <div>
    <p>ウェブページからフィードを生成する<a href="https://github.com/r7kamura/weneedfeed">weneedfeed</a>というツールをつくった。</p>

<h2>使い方</h2>

<p>このツールはRubygemとして実装されているので、Rubyがインストールされている環境が必要になる。ツール自体はgem installでインストールできる。</p>

<pre><code>gem install weneedfeed
</code></pre>

<p>利用者には、URLとCSSセレクタをweneedfeed.ymlというYAML形式のファイルに書いてもらうことになる。例えばこのウェブサイト、r7kamura.comの新着記事のためのRSSフィードを生成しようとすると、こんな内容になる。</p>

<pre><code class="yaml">pages:
  id: r7kamuracom
  title: r7kamura.com
  url: https://r7kamura.com/
  item_selector: li
  item_description_selector: p:nth-child(3)
  item_link_selector: a
  item_time_selector: time
  item_title_selector: p:nth-child(2)
</code></pre>

<p><code>weneedfeed build</code> コマンドを利用すると、適当なRSSフィードをXMLファイルとして <code>./output</code> ディレクトリに出力できる。このファイルをどこかにホスティングして使う訳だが、RSSフィードの中では (ホスト名などの含まれた) 完全な形式のURLを使う必要があるので、このURLの生成に使う情報も引数として与える必要がある。例えば、r7kamura/weneedfeed-r7kamuracomというリポジトリを利用してGitHub Pagesにプロジェクトサイトとしてホスティングしてもらう場合はこういう感じで使う。</p>

<pre><code>weneedfeed build --base-url=https://r7kamura.github.io/weneedfeed-r7kamuracom
</code></pre>

<p>YAMLファイル記述時に手元で動作確認するために、<code>weneedfeed server</code> コマンドが用意されている。localhost:8080でHTTPサーバが立ち上がるので、ブラウザから生成物を確認できる。</p>

<pre><code>weneedfeed server
</code></pre>

<h2>weneedfeed-action</h2>

<p>YAMLファイルからweneedfeedで静的ファイルをつくってGitHub Pagesに配置するという定型的な作業を自動化するために、<a href="https://github.com/r7kamura/weneedfeed-action">weneedfeed-action</a>というGitHub Actionが用意されている。これを使うと、リポジトリにYAMLファイルを置くだけでフィードを用意できるようになる。</p>

<p>例えばこういう感じでGitHub Actions用のworkflowを定義して使う。ファイルの生成にr7kamura/weneedfeed-actionを、ファイルのデプロイにpeaceiris/actions-gh-pagesを使っている。</p>

<pre><code class="yaml"># .github/workflows/publish.yml
name: publish

on:
  push:
    branches:
      - master
  schedule:
    - cron: "15 0 * * *"

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: r7kamura/weneedfeed-action@v3
        with:
          base_url: https://r7kamura.github.io/weneedfeed-r7kamuracom
      - uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: output
</code></pre>

  </div>
</article>

  </main>
</body>
</html>
