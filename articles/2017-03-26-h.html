<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>RubyのUnitテスト系フレームワーク用のテストファイル名のパターンには test/test*.rb を使うのが良さそう</title>
  <link href="https://r7kamura.com/articles/2017-03-26-h" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  
  <meta property="description" content="https://github.com/ruby/rake/blob/af15762f972a3f8322a9b5904d56fe2ff3dd8352/lib/rake/testtask.rb">
  <meta property="og:description" content="https://github.com/ruby/rake/blob/af15762f972a3f8322a9b5904d56fe2ff3dd8352/lib/rake/testtask.rb">
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="RubyのUnitテスト系フレームワーク用のテストファイル名のパターンには test/test*.rb を使うのが良さそう">
  <meta property="og:url" content="https://r7kamura.com/articles/2017-03-26-h">
  
  <meta property="og:image" content="https://r7kamura.com/default_og_image.jpg">
  <meta property="twitter:card" content="summary">
  
</head>
<body>
  <header>
    <nav>
      <a href="/">r7kamura.com</a>
      <ul>
        <li>
          <a href="/articles">一覧</a>
        </li>
        <li>
          <a href="https://www.google.com/search?q=site:r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <header>
    <time datetime="2017-03-26T00:00:00+09:00">2017年03月26日</time>
    <h1>RubyのUnitテスト系フレームワーク用のテストファイル名のパターンには test/test*.rb を使うのが良さそう</h1>
  </header>
  <div>
    <h2>Rake::TestTask</h2>

<p><code>Rake::TestTask</code> がデフォルトでこのパターンなので、これに則っておくことで設定を省略できて良さそう。今まで雰囲気で従っていた慣習に納得の行く理由が新しく発見できて良かった。「RubyのUnitテスト系フレームワーク」と呼んだけれど、正確には「Rubyのスクリプトとしてテストを実行するようなインターフェースを提供しているテストフレームワーク」と呼んだ方が良いかもしれない。</p>

<p><a href="https://github.com/ruby/rake/blob/af15762f972a3f8322a9b5904d56fe2ff3dd8352/lib/rake/testtask.rb">https://github.com/ruby/rake/blob/af15762f972a3f8322a9b5904d56fe2ff3dd8352/lib/rake/testtask.rb</a></p>

<p>例えば <a href="https://github.com/petitest/petitest">Petitest</a> で <code>Rake::TestTask</code> を使って <code>rake test</code> で全てのテストが実行されるようにするには、例えば Rakefile に以下のような定義を行う。</p>

<pre><code>require "rake/testtask"Rake::TestTask.new
</code></pre>

<p>実行する。</p>

<pre><code>rake test
</code></pre>

<p>標準出力の出力結果。</p>

<pre><code>TestRunner #test\_description #test\_full\_description TestSimple #test\_one\_plus\_one\_to\_be\_two TestTest #test\_assertion\_with\_truthy\_block\_to\_pass #test\_assertion\_with\_truthy\_value\_to\_pass Counts: 5 tests 5 passes 0 failures 0 skips Times: Started: 2017-03-26T15:02:46.401250+09:00 Finished: 2017-03-26T15:02:46.404074+09:00 Total: 0.002824s
</code></pre>

<h2>テストのファイルパスとクラス名</h2>

<p>RSpec is a testing DSL, Minitest is Ruby (seattlerb/minitestより) という言葉があるように 、こういうテスト用途で定義されるクラスも定数としてグローバルに参照できるように定義される訳なので、テストファイルも Ruby の他のプログラムと変わらないよという世界観の上では、当然クラス名の命名規則も普段 Ruby でコードを書くときと同じように統一しておくほうが良いと思う。上例では、以下のようなパターンの対応関係でテストのファイルパスとクラス名を割り当てることにしている。</p>

<ul>
<li>test/test_runner.rb -&gt; <code>::TestRunner</code>
</li>
<li>test/test_simple.rb -&gt; <code>::TestTest</code>
</li>
<li>test/test_test.rb -&gt; <code>::TestTest</code>
</li>
</ul>

  </div>
</article>

  </main>
</body>
</html>
