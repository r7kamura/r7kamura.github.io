<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>最近のRails 6対応</title>
  <link href="https://r7kamura.com/articles/2019-04-11-rails-6" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  
  <meta property="description" content="以前 Rails 6.0.0.beta1 を試したときの諸問題について書きましたが、今回はその続きです。">
  <meta property="og:description" content="以前 Rails 6.0.0.beta1 を試したときの諸問題について書きましたが、今回はその続きです。">
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="最近のRails 6対応">
  <meta property="og:url" content="https://r7kamura.com/articles/2019-04-11-rails-6">
  
  <meta property="og:image" content="https://r7kamura.com/default_og_image.jpg">
  <meta property="twitter:card" content="summary">
  
</head>
<body>
  <header>
    <nav>
      <p>
        <a href="/">r7kamura.com</a>
      </p>
      <ul>
        <li>
          <a href="/links">リンク集</a>
        </li>
        <li>
          <a href="https://www.google.com/search?q=site:r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <header>
    <time datetime="2019-04-11T00:00:00+00:00">2019年04月11日</time>
    <h1>最近のRails 6対応</h1>
  </header>
  <div>
    <p>以前 Rails 6.0.0.beta1 を試したときの諸問題について書きましたが、今回はその続きです。現在では Rails 6.0.0.beta3 がリリースされているので、このバージョンで試しています。</p>

<p><a href="https://www.patreon.com/posts/rails-6-0-0-24356189">https://www.patreon.com/posts/rails-6-0-0-24356189</a></p>

<h2>bullet</h2>

<p>以前見たときは Rails 6 対応用の Pull Request が出ている状態でしたが、これが merge されていました。master ブランチでは既に Rails 6 で動くようになっています。</p>

<p><a href="https://github.com/flyerhzm/bullet">https://github.com/flyerhzm/bullet</a></p>

<h2>Module#parent</h2>

<p>Rails 6 では以下のようにメソッド名が変わり、Rails 6.0 からは古い方のメソッドを利用していると警告が出るようになります。</p>

<ul>
<li>Module#parent -&gt; Module#module_parent</li>
<li>Module#parents -&gt; Module#module_parents</li>
<li>Module#parent_name -&gt; Module#module_parent_name</li>
</ul>

<p>active_model_serializers や compass-rails などを利用している関係で影響を受けました。</p>

<p>例: <a href="https://github.com/rails-api/active_model_serializers/pull/2319">https://github.com/rails-api/active_model_serializers/pull/2319</a></p>

<h2>テンプレートハンドラー</h2>

<p>Rails 6 から actionview 用のテンプレートハンドラーが満たすべき仕様が変わる関係で、これを満たしていないものを actionview に登録しようとすると警告が出るようになります。</p>

<p><a href="https://github.com/rails/rails/pull/35119">https://github.com/rails/rails/pull/35119</a></p>

<p>携わっているプロジェクトでは以下の gem が関係していましたが、どれも最新版あるいは GitHub の master で対応されています。</p>

<ul>
<li>coffee-rails</li>
<li>jbuilder</li>
<li>haml</li>
<li>hamlit</li>
</ul>

<p>hamlit は当時はまだ対応されていなかったので Pull Request を出したりしていました。</p>

<p><a href="https://github.com/k0kubun/hamlit/pull/138">https://github.com/k0kubun/hamlit/pull/138</a></p>

<h2>ActionView</h2>

<p>モデルなど、HTTP リクエストのコンテキストではない箇所から ActionView 用のテンプレートを描画するために ActionView::Base.new(...).render(...) というコードがこれまでは動いていたのですが、Rails 6 からは動かなくなったので ApplicationController.render(...) というコードに書き換えました。</p>

<h2>t.timestamp</h2>

<p>過去の migration ファイルに t.timstamps と間違えて t.timestamp というコードが紛れ込んでおり、Rails 5 以前まではこのコードは無視されるのですが、Rails 6 からは t.timestamp はカラム名の無い不正な定義として ArgumentError が発生するようになるので、このコードを消す対応が必要になりました。</p>

<p><a href="https://github.com/rails/rails/pull/35203">https://github.com/rails/rails/pull/35203</a></p>

<p>余談ですが、これは以前 unasuke.rb で作業したときに隣で chiastolite さんが対応した問題でした。</p>

<p><a href="https://www.patreon.com/posts/activerecorddeto-24606070">https://www.patreon.com/posts/activerecorddeto-24606070</a></p>

  </div>
</article>

  </main>
</body>
</html>
