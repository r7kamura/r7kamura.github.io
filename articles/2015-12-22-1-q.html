<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>Atomフィードで順序構造を表現する</title>
  <link href="https://r7kamura.com/articles/2015-12-22-1-q" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  
  <meta property="description" content="Qiitaのアドベントカレンダーでは、http://qiita.com/advent-calendar/2015/vim/feed のようにAtom 1.0を利用してフィードを配信しています。">
  <meta property="og:description" content="Qiitaのアドベントカレンダーでは、http://qiita.com/advent-calendar/2015/vim/feed のようにAtom 1.0を利用してフィードを配信しています。">
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="Atomフィードで順序構造を表現する">
  <meta property="og:url" content="https://r7kamura.com/articles/2015-12-22-1-q">
  
  <meta property="og:image" content="https://r7kamura.com/default_og_image.jpg">
  <meta property="twitter:card" content="summary">
  
</head>
<body>
  <header>
    <nav>
      <p>
        <a href="/">r7kamura.com</a>
      </p>
      <ul>
        <li>
          <a href="/links">リンク集</a>
        </li>
        <li>
          <a href="https://www.google.com/search?q=site:r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <header>
    <time datetime="2015-12-22T00:00:00+00:00">2015年12月22日</time>
    <h1>Atomフィードで順序構造を表現する</h1>
  </header>
  <div>
    <p>Qiitaのアドベントカレンダーでは、<a href="http://qiita.com/advent-calendar/2015/vim/feed">http://qiita.com/advent-calendar/2015/vim/feed</a> のようにAtom 1.0を利用してフィードを配信しています。今回、利用者からの意見を元に「それぞれの記事がそのアドベントカレンダー内の何日目の記事なのか」という情報をこのフィードに含めてみることにしました。</p>

<h2>Atom 1.0の拡張</h2>

<p>Atom 1.0の仕様では、title、id、link、summary、updateのような要素が定義されています。しかし、これらの標準的な要素では、今回のような情報、つまり要素間の順序を表す情報を表現することができません。そこで、それを表現できるような拡張的な仕様を新たに見出す必要がありました。</p>

<p>Atomフィードでは、基本的に <code>http://www.w3.org/2005/Atom</code> という名前空間の元で定義された要素を利用しますが、特に明示的に指定されていない限り、任意の位置で任意の要素を記述することができます。しかし、<code>http://www.w3.org/2005/Atom</code> の名前空間内に新たな要素を勝手に追加することは許されません。そのため、今回は別の名前空間内の適当な要素を利用して順序構造を表現するということになります。</p>

<h2>Atom Ranking Extensions</h2>

<p>幸いにも、これに近い目的を満たすために <a href="https://tools.ietf.org/html/draft-snell-atompub-feed-index-10">Atom Ranking Extensions</a> という仕様がIETFで提案されていたため、今回はこの仕様を利用することにしました。詳細は省きますが、以下のように記述することで、あるフィード内でのentry要素の順位を表現できるようです。<code>http://purl.org/atompub/rank/1.0</code> という名前空間を <code>re</code> という接頭辞で表現し、<code>re:rank</code> という要素でそれを表現しています。</p>

<pre><code class="xml">&lt;feed xml:lang="ja-JP" xmlns="http://www.w3.org/2005/Atom" xmlns:re="http://purl.org/atompub/rank/1.0"&gt;
  ...
  &lt;entry&gt;
    ...
    &lt;re:rank scheme="tag:qiita.com,2005:/advent-calendar"&gt;21&lt;/re:rank&gt;
  &lt;/entry&gt;
  &lt;entry&gt;
    ...
    &lt;re:rank scheme="tag:qiita.com,2005:/advent-calendar"&gt;20&lt;/re:rank&gt;
  &lt;/entry&gt;
&lt;/feed&gt;
</code></pre>

<h2>反省</h2>

<p>Atom Ranking Extensionsは、初期のバージョンでは「Feed Index: Enabling Ordered Entries in Atom」と呼ばれており、要素間の順序を表現するためのものでした。しかし、現在のバージョンではAtom Ranking Extensionsという名前に変わっています。そのため、順序構造というよりは、どちらかと言うと順位を表現するような意味合いが強く、今回の要件は本来のそれとは若干の乖離がある使い方かもしれません。</p>

<h2>おわり</h2>

<p>AtomやRSSのための名前空間は数多く存在しており、例えば <a href="https://validator.w3.org/feed/docs/howto/declare_namespaces.html">https://validator.w3.org/feed/docs/howto/declare_namespaces.html</a> などを見るとそれらの代表的なものを一覧できます。フィードを配信するとき、もし標準的な要素で表現しきれない情報がある場合は、適当な名前空間を利用することを検討してみてください。</p>

  </div>
</article>

  </main>
</body>
</html>
