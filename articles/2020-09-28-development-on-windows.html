<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>Windowsで開発</title>
  <link href="https://r7kamura.com/articles/2020-09-28-development-on-windows" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  
  <meta property="description" content="Windowsで開発環境を整えた。">
  <meta property="og:description" content="Windowsで開発環境を整えた。">
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="Windowsで開発">
  <meta property="og:url" content="https://r7kamura.com/articles/2020-09-28-development-on-windows">
  
  <meta property="og:image" content="https://r7kamura.com/default_og_image.jpg">
  <meta property="twitter:card" content="summary">
  
</head>
<body>
  <header>
    <nav>
      <p>
        <a href="/">r7kamura.com</a>
      </p>
      <ul>
        <li>
          <a href="/links">リンク集</a>
        </li>
        <li>
          <a href="https://www.google.com/search?q=site:r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <header>
    <time datetime="2020-09-28T00:00:00+00:00">2020年09月28日</time>
    <h1>Windowsで開発</h1>
  </header>
  <div>
    <p>Windowsで開発環境を整えた。</p>

<h2>背景</h2>

<p>開発環境を改善しようと思い、PCデスクの見直しなどをやっていたら、Windowsでも開発できるようにしようと思い至った。新しい環境を試してみたい気持ちが1割と、新しいゲーミングPCを組みたい気持ちが9割だ。</p>

<hr>

<h2>エディション</h2>

<p>Windows 10 Homeエディションを利用している。</p>

<p>Windows 10 ProにはHyper-Vという仮想化機能を直接利用できる利点があるが、WSL2で同じようなことをより便利に実現できるようになったおかげで、この点においてPro版の必要性は薄れてきている。今のところ自分のやりたいことはWindows 10 Homeですべて実現できている。</p>

<h2>Windows Update</h2>

<p>WSL2を使うために、Windowsをバージョン2004・ビルド19041に更新した。</p>

<p>日々の自動更新ではバージョン1903で止まっていて、まだ自動では2004に上がらない状態だったので、<a href="https://www.microsoft.com/ja-jp/software-download/windows10">Windows 10 のダウンロード</a> というページにアクセスし、最新版への移行アシスタントをダウンロードして実行。最近のやつに上げると、WSL2が有効化できるようになる。</p>

<h2>WSL2</h2>

<p>Linuxディストリビューションを入れるために、WSL2を入れる。</p>

<p>WindowsがWSL2に対応したバージョンになっていることを確認した後、<a href="https://docs.microsoft.com/ja-jp/windows/wsl/install-win10">Windows Subsystem for Linux (WSL) を Windows 10 にインストールする</a> というガイドを見ながら、以下のコマンドで、WSL2の有効化と、仮想マシンプラットフォームの有効化というやつを試みる。</p>

<p>全体を通して言えることだが、破壊的変更をもたらすようなコマンドは管理者権限で起動した端末を利用しないと実行できないので、その点は注意。</p>

<pre><code>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
</code></pre>

<p>有効化後、再起動するとWSLがインストールされており、コマンドプロンプトやPowerShellなどで <code>wsl</code> コマンドが使えるようになっている。WSL1とWSL2が入るので、デフォルトでWSL2を使うように設定しておく。</p>

<pre><code>wsl --set-default-version 2
</code></pre>

<h2>Ubuntu 20.04 LTS</h2>

<p>開発環境として使うためのLinuxディストリビューションを入れる。</p>

<p>Windowsに標準搭載されているMicrosoft Storeというアプリで、Linuxディストリビューション（をターミナル付きで起動できていい感じにWSL2と連携するようにラップしてくれたアプリケーション）が無料で配布されている。今回はUbuntu 20.04 LTSを選択した。</p>

<p>インストールして起動すると、PowerShell 7っぽい見た目のターミナルで初回のユーザ作成プロセスが立ち上がり、完了するとUbuntuの中に放り出される。</p>

<p>Windows側の端末で <code>wsl</code> コマンドを使うと、管理しているLinuxディストリビューションが増えていることが確認できる。</p>

<pre><code>wsl --list --verbose
</code></pre>

<p><code>wsl</code> コマンドを引数無しでそのまま使うと、その端末の中でシームレスにLinuxディストリビューション側にログインできる。</p>

<h2>Docker Desktop for Windows</h2>

<p>Dockerを活用するために、Docker Desktop for Windowsを入れる。</p>

<p>Dockerが専用のエンジンで動くようになり、WindowsやLinux環境では <code>docker</code> コマンド経由でそこに対して命令を出す形になる。Windowsとの間でネットワークをいい感じにブリッジしてくれたりして非常に便利。</p>

<p>基本的に、開発で必要なソフトウェアはDockerイメージとして用意するように配慮して、開発用のLinuxディストリビューション側は、gitやtmuxなどの、汎用的なファイル操作や端末操作のためのソフトウェアを入れるに留めたい。</p>

<h2>Windows Package Manager</h2>

<p>エディタや端末など、Windowsで使うアプリを簡単に入れるために、公式のパッケージマネージャを入れる。</p>

<p>まだまだ未発展なところも多いものの、使ってみるとそれなりに便利。
<a href="https://github.com/microsoft/winget-cli/releases">GitHubリポジトリで配布されているインストーラ</a> を実行すると入れられる。完了すると、Windows側の端末で <code>winget</code> というコマンドが使えるようになる。</p>

<h2>Windows Terminal</h2>

<p>Windows公式の最強の端末を入れる。</p>

<pre><code>winget install "Windows Terminal"
</code></pre>

<p>これは全部盛りのアプリケーションで、内部でタブとしていろんな種類の端末を開けるようになっている。自分の環境では、コマンドプロンプト、PowerShell 5、PowerShell 7、Ubuntu用端末、Azure Cloud Shellなどの選択肢がある。色々考えるとそれなりに良い使い心地なので、端末はこれに落ち着いた。</p>

<p>注意してほしいのが、アンチエイリアスやフレーム更新などの描画処理をこだわっているせいなのか、グラフィック周りが不安定になることがある。自分の場合、G-SYNCを有効化しているとこのアプリケーションがアクティブなときだけ画面全体がちらつくようになったので、アプリケーションが全画面化されているとき以外はG-SYNCを無効化することにした。</p>

<p>デフォルトのフォントは日本語をサポートしていないので、ＭＳゴシックに変更する。設定を開くと settings.json がいきなり開くので、<a href="https://docs.microsoft.com/ja-jp/windows/terminal/customize-settings/profile-settings">Windows ターミナル プロファイルの設定</a> を見ながら適当に編集する。</p>

<pre><code class="json">{
  "profiles": {
    "defaults": {
      "fontFace": "ＭＳゴシック"
    }
  }
}
</code></pre>

<h2>Visual Studio Code</h2>

<p>主なエディタとしてVisual Studio Codeを使っている。</p>

<p>Visual Studio Codeではこの手の環境のためにリモート機能が提供されていて、Linux側とWindows側のそれぞれのVisual Studio Codeのプロセスが協調し、ファイルをWindows側のGUIで編集したり、コマンドをLinux側で処理させたりできる。</p>

<p>Linux側で <code>code</code> コマンドを使ってワークスペースを編集しようとすると、Windows側のGUIでそれが開き、適当に編集するだけで基本上手くいく。</p>

<pre><code>winget install "Visual Studio Code"
</code></pre>

<p>Windows側でインストールすれば、Linux側でも使える。</p>

<hr>

<p>これでWindowsに依存した部分の環境構築は一段落。あとは開発用に用意したUbuntuをいい感じに整えていくだけだ。</p>

<p><a href="https://github.com/r7kamura/r7kamura.com">このサイトのリポジトリ</a>でもDocker環境を用意していたので、試しにUbuntu側にリポジトリをcloneしてきて、Visual Studio Codeで編集し、DockerでRubyのサーバを動かし、Windows側でプレビューする、ということをやりながらこの記事を書いてみた。</p>

  </div>
</article>

  </main>
</body>
</html>
